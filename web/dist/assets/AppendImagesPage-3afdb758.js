import{u as B,r as u,c as F,l as L,e as b,o as l,a,b as e,m as h,p as x,w as D,v as V,t as n,g as j,h as v,F as k,f as y,q as w,n as z}from"./vendor-29d2aae4.js";import{_ as M,I as T,u as G,a as P,b as Q}from"./index-a62c43a1.js";import"./axios-b5ee139b.js";const E={name:"AppendImagesPage",components:{ImageUploader:T},setup(){B();const m=G(),t=u(!1),g=u(""),s=u(""),i=u(null),d=u([]),c=u(!1),p=F(()=>s.value?m.items.filter(o=>o.title.toLowerCase().includes(s.value.toLowerCase())):m.items),r=async()=>{try{t.value=!0,g.value="",await m.fetchList({limit:1e3})}catch(o){g.value="加载作品列表失败",console.error("加载作品列表失败:",o)}finally{t.value=!1}},f=()=>{clearTimeout(s.value.debounceTimer),s.value.debounceTimer=setTimeout(()=>{},300)},A=o=>{i.value=o,d.value=[]},C=()=>{i.value=null,d.value=[]},I=o=>{d.value=o},S=async()=>{if(!(!i.value||!d.value.length))try{c.value=!0;const o=await P(d.value,i.value._id);if(o.success){alert("图片上传成功！"),await r();const _=m.items.find(U=>U._id===i.value._id);_&&(i.value=_),d.value=[]}else throw new Error(o.error||"上传失败")}catch(o){console.error("上传图片失败:",o),alert(o.message||"上传图片失败")}finally{c.value=!1}},N=o=>new Date(o).toLocaleDateString("zh-CN");return L(()=>{r()}),{loading:t,error:g,searchQuery:s,selectedArtwork:i,selectedFiles:d,uploading:c,filteredArtworks:p,loadArtworks:r,handleSearch:f,selectArtwork:A,clearSelection:C,handleFilesChange:I,handleUploadImages:S,formatDate:N}}},q={class:"min-h-screen bg-nature-canvas"},H={class:"bg-white shadow-frame border-b-2 border-nature-warm"},J={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},R={class:"flex items-center justify-between"},K={class:"flex items-center space-x-4"},O={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},W={class:"bg-white rounded-xl shadow-frame p-6 mb-8"},X={class:"mb-6"},Y={class:"relative max-w-md"},Z={key:0,class:"text-center py-12"},$={key:1,class:"text-center py-12"},ee={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg max-w-md mx-auto"},te={class:"mb-3"},se={key:2,class:"text-center py-12"},re={class:"text-nature-dark mb-6"},oe={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},le=["onClick"],ae={class:"relative aspect-[4/3] overflow-hidden rounded-t-xl"},ne=["src","alt"],ie={class:"absolute top-3 right-3 bg-black bg-opacity-60 text-white text-sm px-2 py-1 rounded-full"},de={class:"p-4"},ce={class:"text-lg font-serif text-nature-forest mb-2 line-clamp-2"},ue={class:"text-sm text-nature-dark line-clamp-2"},me={class:"mt-3 text-xs text-nature-sky"},fe={key:0,class:"bg-white rounded-xl shadow-frame p-6 mb-8"},ge={class:"text-xl font-serif text-nature-forest mb-4"},he={class:"mb-6"},xe={class:"text-lg font-serif text-nature-forest mb-3"},ve={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"},we=["src","alt"],pe={key:0,class:"absolute top-1 left-1 bg-nature-forest text-white text-xs px-1 py-0.5 rounded"},_e={class:"mt-4 text-sm text-nature-dark"},be={class:"mt-6 flex space-x-3"},ke=["disabled"],ye={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"};function Ae(m,t,g,s,i,d){const c=b("router-link"),p=b("ImageUploader");return l(),a("div",q,[e("header",H,[e("div",J,[e("div",R,[h(c,{to:"/",class:"flex-shrink-0 hover:opacity-80 transition-opacity duration-200 mr-6"},{default:x(()=>[...t[5]||(t[5]=[e("img",{src:Q,alt:"Jeffry Goh Art Logo",class:"h-12 md:h-16 w-auto object-contain"},null,-1)])]),_:1}),t[8]||(t[8]=e("div",null,[e("h1",{class:"text-3xl font-serif text-nature-forest"},"Add New Images to Existing Collection"),e("p",{class:"text-nature-dark mt-1"},"Select existing artwork and add new images")],-1)),e("div",K,[h(c,{to:"/admin",class:"btn-outline"},{default:x(()=>[...t[6]||(t[6]=[w(" Back to Dashboard ",-1)])]),_:1}),h(c,{to:"/",class:"btn-secondary"},{default:x(()=>[...t[7]||(t[7]=[w(" View Gallery ",-1)])]),_:1})])])])]),e("main",O,[e("div",W,[t[14]||(t[14]=e("h2",{class:"text-xl font-serif text-nature-forest mb-4"},"Select Artwork to Add Images",-1)),e("div",X,[e("div",Y,[D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.searchQuery=r),onInput:t[1]||(t[1]=(...r)=>s.handleSearch&&s.handleSearch(...r)),type:"text",placeholder:"Search artwork titles...",class:"input-field pr-12"},null,544),[[V,s.searchQuery]]),t[9]||(t[9]=e("svg",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-nature-forest",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),s.loading?(l(),a("div",Z,[...t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-nature-forest mx-auto mb-4"},null,-1),e("p",{class:"text-nature-dark"},"Loading artworks...",-1)])])):s.error?(l(),a("div",$,[e("div",ee,[e("p",te,n(s.error),1),e("button",{onClick:t[2]||(t[2]=(...r)=>s.loadArtworks&&s.loadArtworks(...r)),class:"btn-primary"},"Retry")])])):s.filteredArtworks.length===0?(l(),a("div",se,[t[12]||(t[12]=e("div",{class:"bg-nature-warm rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6"},[e("svg",{class:"w-12 h-12 text-nature-forest",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t[13]||(t[13]=e("h3",{class:"text-xl font-serif text-nature-forest mb-2"},"No Artworks",-1)),e("p",re,n(s.searchQuery?"No matching artworks found":"No artworks in gallery yet, please create one first"),1),s.searchQuery?v("",!0):(l(),j(c,{key:0,to:"/admin/artworks/new",class:"btn-primary"},{default:x(()=>[...t[11]||(t[11]=[w(" Create First Artwork ",-1)])]),_:1}))])):(l(),a("div",oe,[(l(!0),a(k,null,y(s.filteredArtworks,r=>(l(),a("div",{key:r._id,class:"artwork-card bg-white rounded-xl shadow-frame border-2 border-nature-warm hover:border-nature-forest hover:shadow-frame-hover transition-all duration-300 cursor-pointer",onClick:f=>s.selectArtwork(r)},[e("div",ae,[e("img",{src:r.coverImage.thumbnailUrl,alt:r.title,class:"w-full h-full object-cover"},null,8,ne),e("div",ie,n(r.images.length)+" images ",1)]),e("div",de,[e("h3",ce,n(r.title),1),e("p",ue,n(r.description),1),e("div",me," 创建时间："+n(s.formatDate(r.creationDate)),1)])],8,le))),128))]))]),s.selectedArtwork?(l(),a("div",fe,[e("h2",ge,"选中的作品："+n(s.selectedArtwork.title),1),e("div",he,[e("h3",xe,"当前图片 ("+n(s.selectedArtwork.images.length)+" 张)",1),e("div",ve,[(l(!0),a(k,null,y(s.selectedArtwork.images,(r,f)=>(l(),a("div",{key:f,class:z(["relative aspect-square rounded-lg overflow-hidden border-2",r.url===s.selectedArtwork.coverImage.url?"border-nature-forest":"border-nature-warm"])},[e("img",{src:r.thumbnailUrl,alt:`${s.selectedArtwork.title} - 图片 ${f+1}`,class:"w-full h-full object-cover"},null,8,we),r.url===s.selectedArtwork.coverImage.url?(l(),a("div",pe," 封面 ")):v("",!0)],2))),128))])]),e("div",null,[t[17]||(t[17]=e("h3",{class:"text-lg font-serif text-nature-forest mb-3"},"上传新图片",-1)),h(p,{ref:"imageUploader",onFilesChange:s.handleFilesChange,"max-files":12-s.selectedArtwork.images.length,"max-file-size":10*1024*1024},null,8,["onFilesChange","max-files"]),e("div",_e,[e("p",null,"• 最多可上传 "+n(12-s.selectedArtwork.images.length)+" 张新图片",1),t[15]||(t[15]=e("p",null,"• 支持 JPG、PNG 格式，单张图片不超过 10MB",-1)),t[16]||(t[16]=e("p",null,"• 新图片将添加到现有图片集的末尾",-1))])]),e("div",be,[e("button",{onClick:t[3]||(t[3]=(...r)=>s.handleUploadImages&&s.handleUploadImages(...r)),disabled:!s.selectedFiles.length||s.uploading,class:"btn-primary disabled:opacity-50"},[s.uploading?(l(),a("svg",ye,[...t[18]||(t[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):v("",!0),w(" "+n(s.uploading?"上传中...":"上传新图片"),1)],8,ke),e("button",{onClick:t[4]||(t[4]=(...r)=>s.clearSelection&&s.clearSelection(...r)),class:"btn-secondary"}," 重新选择作品 ")])])):v("",!0)])])}const Ne=M(E,[["render",Ae],["__scopeId","data-v-f20f0444"]]);export{Ne as default};
